{"version":3,"file":"imageeditable.min.js","sources":["../src/imageeditable.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Adding resize option to theme academylite.\n *\n * @module     theme_enva/imageeditable\n * @copyright  2024 Bas Brands\n * @author     Bas Brands\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\nimport imageHandler from 'theme_enva/imagehandler';\n\n\n/**\n * The init function for the image editable.\n *\n * Editable images are wrapped in a div with region=\"imageeditable\" and a data-contextid attribute.\n * If the user is editing the page, a file upload button is added to the div.\n * On click the user can browse for an image and upload it.\n * The image is then displayed in the div.\n */\nexport const init = () => {\n    const editableImages = document.querySelectorAll('[data-region=\"imageeditable\"]');\n    editableImages.forEach((editableImage) => {\n        const contextId = editableImage.getAttribute('data-contextid');\n        const image = editableImage.querySelector('img');\n\n        const fileInput = document.createElement('input');\n        fileInput.setAttribute('type', 'file');\n        fileInput.setAttribute('accept', 'image/*');\n        fileInput.setAttribute('class', 'hidden');\n\n        const imageUploadButton = document.createElement('button');\n        imageUploadButton.setAttribute('type', 'button');\n        imageUploadButton.classList.add('btn', 'btn-secondary', 'uploadbutton');\n\n        const imageUploadIcon = document.createElement('i');\n        imageUploadIcon.classList.add('fa', 'fa-upload');\n        imageUploadButton.appendChild(imageUploadIcon);\n\n        getString('uploadimage', 'theme_enva').then((string) => {\n            const imageUploadText = document.createElement('span');\n            imageUploadText.classList.add('sr-only');\n            imageUploadText.innerHTML = string;\n            imageUploadButton.appendChild(imageUploadText);\n            return '';\n        }).catch(Notification.exception);\n\n        editableImage.appendChild(imageUploadButton);\n\n        imageUploadButton.addEventListener('click', () => {\n            fileInput.click();\n        });\n\n        fileInput.addEventListener('change', (e) => {\n            const file = e.target.files[0];\n            const reader = new FileReader();\n            reader.addEventListener('load', () => {\n                imageHandler.saveImage(contextId, 'overviewfiles', file, reader.result).then((result) => {\n                    if (result.success) {\n                        image.setAttribute('src', result.fileurl);\n                    }\n                    return '';\n\n                }).catch(Notification.exception);\n            });\n            reader.readAsDataURL(file);\n        });\n    });\n};\n\n"],"names":["document","querySelectorAll","forEach","editableImage","contextId","getAttribute","image","querySelector","fileInput","createElement","setAttribute","imageUploadButton","classList","add","imageUploadIcon","appendChild","then","string","imageUploadText","innerHTML","catch","Notification","exception","addEventListener","click","e","file","target","files","reader","FileReader","saveImage","result","success","fileurl","readAsDataURL"],"mappings":";;;;;;;;wMAqCoB,KACOA,SAASC,iBAAiB,iCAClCC,SAASC,sBACdC,UAAYD,cAAcE,aAAa,kBACvCC,MAAQH,cAAcI,cAAc,OAEpCC,UAAYR,SAASS,cAAc,SACzCD,UAAUE,aAAa,OAAQ,QAC/BF,UAAUE,aAAa,SAAU,WACjCF,UAAUE,aAAa,QAAS,gBAE1BC,kBAAoBX,SAASS,cAAc,UACjDE,kBAAkBD,aAAa,OAAQ,UACvCC,kBAAkBC,UAAUC,IAAI,MAAO,gBAAiB,sBAElDC,gBAAkBd,SAASS,cAAc,KAC/CK,gBAAgBF,UAAUC,IAAI,KAAM,aACpCF,kBAAkBI,YAAYD,qCAEpB,cAAe,cAAcE,MAAMC,eACnCC,gBAAkBlB,SAASS,cAAc,eAC/CS,gBAAgBN,UAAUC,IAAI,WAC9BK,gBAAgBC,UAAYF,OAC5BN,kBAAkBI,YAAYG,iBACvB,MACRE,MAAMC,sBAAaC,WAEtBnB,cAAcY,YAAYJ,mBAE1BA,kBAAkBY,iBAAiB,SAAS,KACxCf,UAAUgB,WAGdhB,UAAUe,iBAAiB,UAAWE,UAC5BC,KAAOD,EAAEE,OAAOC,MAAM,GACtBC,OAAS,IAAIC,WACnBD,OAAON,iBAAiB,QAAQ,2BACfQ,UAAU3B,UAAW,gBAAiBsB,KAAMG,OAAOG,QAAQhB,MAAMgB,SACtEA,OAAOC,SACP3B,MAAMI,aAAa,MAAOsB,OAAOE,SAE9B,MAERd,MAAMC,sBAAaC,cAE1BO,OAAOM,cAAcT"}